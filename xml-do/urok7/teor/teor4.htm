<html><!-- InstanceBegin template="/Templates/shablon7.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<!-- InstanceBeginEditable name="doctitle" -->
<title>XML: для интернет-магазинов и каталогов</title>
<!-- InstanceEndEditable --><meta name="description" content="Business website">
<meta name="keywords" content="business, website">
<link href="../../css/style.css" rel="stylesheet" type="text/css">
<style type="text/css">
<!--
.style2 {color: #FFFFFF}
-->
</style>
<!-- InstanceBeginEditable name="head" --><!-- InstanceEndEditable -->
</head>
<body leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<table width="100%" height="100%"  border="0" cellpadding="0" cellspacing="0">
<tr>
<td height="1" background="../../images/bg_head.gif"><table width="100%" height="64"  border="0" cellpadding="0" cellspacing="0">
<tr>
<td width="63" valign="top"><img src="../../images/head_l.gif" width="63" height="64"></td>
<td width="300" background="../../images/bg_logo.gif"><table height="64"  border="0" cellpadding="0" cellspacing="0">
<tr>
<td width="26"><img src="../../images/logo_l.gif" width="26" height="64"></td>
<td width="32" height="64"><table width="32"  border="0" cellpadding="0" cellspacing="0">
<tr>
<td height="23"><img src="../../images/spacer.gif" width="1" height="23"></td>
</tr>
<tr>
<td width="32" height="32"><img src="../../images/spacer.gif" width="27" height="27" border="0"></td>
</tr>
<tr>
<td height="9"><img src="../../images/spacer.gif" width="1" height="9"></td>
</tr>
</table></td>
<td width="6" height="64"><img src="../../images/spacer.gif" width="6" height="1"></td>
<td height="64"><table width="100%"  border="0" cellpadding="0" cellspacing="0">
<tr>
<td height="23"><img src="../../images/spacer.gif" width="1" height="23"></td>
<td width="17" rowspan="3"><img src="../../images/spacer.gif" width="17" height="8"></td>
</tr>
<tr>
<td height="32" class="logo style2"> XML: для интернет-магазинов и каталогов </td>
</tr>
<tr>
<td height="9"><img src="../../images/spacer.gif" width="1" height="9"></td>
</tr>
</table></td>
<td width="14"><img src="../../images/head_r.gif" width="14" height="64"></td>
</tr>
</table></td>
<td width="45"><img src="../../images/spacer.gif" width="45" height="1"></td>
<td width="100%"><table width="100" height="64" border="0" cellpadding="0" cellspacing="0">
<tr>
<td height="27"><img src="../../images/spacer.gif" width="1" height="27"></td>
</tr>
<tr>
<td height="23" background="../../images/bg_menu.gif"><table height="23" border="0" cellpadding="0" cellspacing="0">
<tr>
<td width="11"><img src="../../images/menu_l.gif" width="11" height="23"></td>
<td><table width="100%" height="23"  border="0" cellpadding="0" cellspacing="0">
<tr>
<td height="5"><img src="../../images/spacer.gif" width="1" height="5"></td>
</tr>
<tr>
<td align="center"><a href="../index.htm" class="menu">Теория</a></td>
</tr>
</table></td>
<td width="10"><img src="../../images/menu_r.gif" width="10" height="23"></td>
<td width="11"><img src="../../images/menu_l.gif" width="11" height="23"></td>
<td><table width="100%" height="23"  border="0" cellpadding="0" cellspacing="0">
<tr>
<td height="5"><img src="../../images/spacer.gif" width="1" height="5"></td>
</tr>
<tr>
<td align="center"><a href="../prakt.htm" class="menu">Практическая работа
</a></td>
</tr>
</table></td>
<td width="10"><img src="../../images/menu_r.gif" width="10" height="23"></td>
<td width="11"><img src="../../images/menu_l.gif" width="11" height="23"></td>
<td><table width="100%" height="23"  border="0" cellpadding="0" cellspacing="0">
<tr>
<td height="5"><img src="../../images/spacer.gif" width="1" height="5"></td>
</tr>
<tr>
<td align="center"><a href="../samost.htm" class="menu">Самостоятельная работа </a></td>
</tr>
</table></td>
<td width="10"><img src="../../images/menu_r.gif" width="10" height="23"></td>
<td width="11"><img src="../../images/menu_l.gif" width="11" height="23"></td>
<td><table width="100%" height="23"  border="0" cellpadding="0" cellspacing="0">
<tr>
<td height="5"><img src="../../images/spacer.gif" width="1" height="5"></td>
</tr>
<tr>
<td align="center"><a href="javascript:alert('В данном курсе тестирование не предусмотрено')" class="menu">Тестирование</a></td>
</tr>
</table></td>
<td width="16"><img src="../../images/menu_r2.gif" width="16" height="23"></td>
</tr>
</table></td>
</tr>
<tr>
<td height="14"><img src="../../images/spacer.gif" width="1" height="14"></td>
</tr>
</table></td>
<td width="27" align="right" valign="bottom"><img src="../../images/head_r2.gif" width="55" height="14"></td>
</tr>
</table></td>
</tr>
<tr>
<td height="100%" valign="top"><table width="100%" height="100%"  border="0" cellpadding="0" cellspacing="0">
<tr>
<td width="26" background="../../images/bg_main.gif" bgcolor="#5A8395" class="bgrx">&nbsp;</td>
<td width="2" valign="top" background="../../images/bg_rmain.gif" bgcolor="#FFFFFF" class="bgrxbtm"><img src="../../images/el_5.gif" width="2" height="32"></td>
<td width="276" valign="top" bgcolor="#FFFFFF"><table width="300"  border="0" cellpadding="0" cellspacing="0">
<tr>
<td height="1" bgcolor="#FFFFFF"><img src="../../images/logo-main.jpg" width="300" height="326"></td>
</tr>
<tr>
<td height="6" bgcolor="#FFFFFF"><img src="../../images/spacer.gif" width="1" height="6"></td>
</tr>
<tr>
  <td align="center"><table width="100%"  border="0" align="center" cellpadding="3" cellspacing="0">
    <tr>
      <td> <a href="teor1.htm">1. Необходимость в преобразовании XML документа</a></td>
    </tr>
    <tr>
      <td> <a href="teor2.htm">2. Пример преобразования XML-файла</a></td>
    </tr>
    <tr>
      <td> <a href="teor3.htm">3. Использование XSL файла с XML документом</a></td>
    </tr>
    <tr>
      <td> <a href="teor4.htm">4. Создание правил преобразования</a></td>
    </tr>
    <tr>
      <td> <a href="teor5.htm">5. Сортировка XML документа</a></td>
    </tr>
  </table></td>
</tr>
<tr>
<td height="1" bgcolor="#FFFFFF"><img src="../../images/spacer.gif" width="1" height="1"></td>
</tr>
</table></td>
<td width="26" bgcolor="#FFFFFF"><img src="../../images/spacer.gif" width="26" height="1"></td>
<td valign="top" background="../../images/bg_text.gif" bgcolor="#FFFFFF" class="bgrx"><table width="100%" height="100%"  border="0" cellpadding="0" cellspacing="0">
<tr>
<td height="100%" valign="top"><table width="100%" height="32"  border="0" cellpadding="0" cellspacing="0">
<tr>
<td width="11">&nbsp;</td>
<td><h1><strong>Урок 7. </strong> Преобразование XML документа с использованием xpath<br>
</h1></td>
<td width="39"><img src="../../images/el_3.gif" width="39" height="32"></td>
</tr>
<tr>
<td><img src="../../images/spacer.gif" width="1" height="1"></td>
<td height="1" colspan="2" align="right" bgcolor="#FFFFFF"><img src="../../images/el_4.gif" width="29" height="1"></td>
</tr>
</table>
<table width="100%" height="100%"  border="0" cellpadding="0" cellspacing="0">
<tr>
<td height="8" colspan="3" valign="top"><img src="../../images/spacer.gif" width="1" height="8"></td>
<td width="20" rowspan="2" bgcolor="#FFFFFF"><img src="../../images/spacer.gif" width="20" height="1"></td>
</tr>
<tr>
<td width="11" valign="top">&nbsp;</td>
<td valign="top"><!-- InstanceBeginEditable name="EditRegion3" -->
  <h1>4. Создание правил преобразования </h1>
  <p>&nbsp;</p>
  <p>Правила преобразования определяют каким образом обработчик XSLT сформирует выходной элемент при нахождении элементов входного файла в соответствии с шаблоном. Каждое правило определяется элементом &lt;xsl:template&gt;. Каждый элемент содержит: </p>
  <p>1. <strong>Шаблон соответствия</strong> для поиска элементов, который представляет XPath выражение для нахождения требуемых узлов (элементов, атрибутов) в XML -документе. </p>
  <p>2. <strong>Выходной шаблон</strong>, который находится между начальным и конечным &lt; xsl : template &gt; тэгами. Выходной шаблон содержит инструкции для форматирования результата. Выходной шаблон может быть пустым (для подавления вывода информации из элементов) или включать различные текстовые значения, XML , HTML элементы. Синтаксис правила можно представить в следующем виде: </p>
  <blockquote>
    <p>&lt;xsl:template match=&quot; выражение XPATH&quot;&gt; </p>
    <p>Выходной шаблон </p>
    <p>&lt;/xsl:template&gt; </p>
  </blockquote>
  <p><strong>Пример правила</strong>: </p>
  <blockquote>
    <p>&lt;xsl:template match=&quot;tovar&quot;&gt; </p>
    <p>&lt;H1&gt; Показ товара &lt;/H1&gt; <br>
&lt;/xsl:template&gt; </p>
  </blockquote>
  <p>При использовании этого правила для всех элементов tovar будет выведена строка Показ товара , отформатированная как заголовок 1-го уровня. Для показа в выходном документе информационного содержания документа может использоваться элемент &lt; xsl:value-of&gt;. <strong></strong>В этом элементе задается также выражение XPath, согласно которому будет выполняться поиск подчиненных элементов или атрибутов для узлов, найденных согласно правилу &lt;xsl:template …&gt; </p>
  <p>Например, для формирования в выходном документе в формате HTML информации по ценам товаров (элемент price ) из XML -файла cо следующей структурой: </p>
  <blockquote>
    <p>&lt;tovars&gt; </p>
    <p>&lt;opis&gt; Товары фирмы &lt;/opis&gt; </p>
    <p>&lt;tovar&gt; </p>
    <p>&lt;naim&gt; Бензин &lt;/naim&gt; </p>
    <p>&lt;price&gt;10&lt;/price&gt; </p>
    <p>&lt;/tovar&gt; </p>
    <p>&lt;tovar&gt; </p>
    <p>&lt;naim&gt; Керосин &lt;/naim&gt; </p>
    <p>&lt;price&gt;100&lt;/price&gt; </p>
    <p>&lt;/tovar&gt; </p>
    <p>&lt;/tovars&gt; </p>
  </blockquote>
  <p>используется такое правило: </p>
  <blockquote>
    <p>&lt;xsl:template match=”tovar”&gt; </p>
    <p>&lt;p&gt; Цена товара=&lt;xsl:value-of select=”price”&gt;&lt;/p&gt; </p>
    <p>&lt;/xsl:template&gt; </p>
  </blockquote>
  <p>При использовании этого правила осуществляется поиск элементов с именем tovar при использовании правила &lt;xsl:template match=”tovar”&gt;, а затем выполняется поиск подчиненных элементов с именем price c использованием элемента &lt;xsl:value-of select =”price”&gt; </p>
  <p>Согласно этому правилу в выходной элемент должна попасть только часть XML -документа, а именно информационная часть элементов price , которые являются подчиненными элементами элементов tovar. Так как требуется сформировать выходной документ в формате HTML, необходимо указать начальные и конечные элементы (тэги) html -документа. Эти элементы выводятся один раз для всего выходного документа и поэтому они не могут выводится при помощи правила, основанного на совпадении с элементом tovar. Для этой цели оптимально подходит корневой элемент XSL, соответствие с которым достигается выражением XPath , объявляемым символом «слеш» (/). Следовательно, XSL -файл примет следующий вид: </p>
  <blockquote>
    <p>&lt;?xml version=&quot;1.0&quot; encoding=&quot;windows-1251&quot;?&gt; </p>
    <p>&lt;xsl:stylesheet version =&quot;1.0&quot; </p>
    <p>xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt; </p>
    <p>&lt;xsl:template match=”/”&gt; </p>
    <p>&lt;HTML&gt; </p>
    <p>&lt;BODY&gt; </p>
    <p>&lt;xsl:apply-template/&gt; </p>
    <p>&lt;/BODY&gt; </p>
    <p>&lt;/HTML&gt; </p>
    <p>&lt;/xsl:template&gt; </p>
    <p>&lt;xsl:template match=”tovar”&gt; </p>
    <p>&lt;p&gt; Цена товара=&lt;xsl:value-of select=”price”&gt;&lt;/p&gt; </p>
    <p>&lt;/xsl:template&gt; </p>
  </blockquote>
  <p>Согласно этому XSL-файлу, в выходной документ должна попасть только информация о ценах (элемент price). Однако в выходном документе присутствует также и информационное содержимое элемента opis:</p>
  <div align="center"><img src="../images/ur_07_teor_ris_04.jpg" width="334" height="242">
  </div>
  <p>&nbsp;</p>
  <p>Это связано с тем, что в каждом XSL-файле «незримо» присутствует 2 правила по умолчанию, первое из которых применяется ко всем элементам (узлам), которые явно не указаны в правилах, но являются промежуточными в семействе узлов или корневым узлом (если он не указан явно в правилах). </p>
  <blockquote>
    <p>&lt;xsl:template match=&quot;*|/&quot;&gt; </p>
    <p>&lt;xsl:apply-templates/&gt; <br>
&lt;/xsl:template&gt; </p>
  </blockquote>
  <p>и </p>
  <blockquote>
    <p>&lt;xsl:template match=&quot;text()|@*&quot;&gt; </p>
    <p>&lt;xsl:value-of select=&quot;.&quot;/&gt; </p>
    <p>&lt;/xsl:template&gt; </p>
  </blockquote>
  <p>Это правило выводит в выходной документ информационное содержимое элементов и атрибуты, элементов, которые соответствуют предыдущему правилу. </p>
  <p>В данном случае обработка документа начинается с корневого элемента XSL, дочерним для которого будет корневой элемент tovars . В списке правил этот элемент отсутствует, но будет выведен в выходной документ по причине правила по умолчанию. Если бы этих правил был бы невозможен вывод информационного содержимого элементов tovar , ведь переход от корневого элемента XSL к элементу tovar использует элемент tovars, явно к правилам не указанный. </p>
  <p>Для того, чтобы нейтрализовать вывод нежелательных элементов, требуется ограничить применение правил. Для этого можно в элементе &lt; xsl : apply - template применить атрибут select , указав элемент tovar , следующим образом: </p>
  <blockquote>
    <p>&lt;?xml version=&quot;1.0&quot; encoding=&quot;windows-1251&quot;?&gt; </p>
    <p>&lt;xsl:stylesheet version =&quot;1.0&quot; </p>
    <p>xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt; </p>
    <p>&lt;xsl:template match=&quot;/&quot;&gt; </p>
    <p>&lt;html&gt; </p>
    <p>&lt;body&gt; </p>
    <p>&lt;xsl:apply-templates select=&quot;tovars/tovar&quot;/&gt; </p>
    <p>&lt;/body&gt; </p>
    <p>&lt;/html&gt; </p>
    <p>&lt;/xsl:template&gt; </p>
    <p>&lt;xsl:template match=&quot;tovar&quot;&gt; </p>
    <p>&lt;h2&gt;Цена товара:&lt;xsl:value-of select=&quot;price&quot;/&gt;&lt;/h2&gt; </p>
    <p>&lt;/xsl:template&gt; </p>
    <p>&lt;/xsl:stylesheet&gt; </p>
    </blockquote>
  <p>Выходной документ приобретает вид, показанный на рисунке:</p>
  <div align="center"><img src="../images/ur_07_teor_ris_05.jpg" width="282" height="230">
  </div>
  <p>&nbsp;</p>
  <div align="right"><a href="teor5.htm"><strong>Далее &gt;&gt;&gt;</strong></a></div>
  <p>&nbsp;</p>
  <h1>&nbsp;</h1>
  <!-- InstanceEndEditable --></td>
<td width="9" valign="top"><img src="../../images/spacer.gif" width="9" height="1"></td>
</tr>
</table></td>
</tr>
<tr valign="bottom">
<td><table width="100%" height="20"  border="0" cellpadding="0" cellspacing="0" background="../../images/bg_bottom_menu.gif">
<tr>
<td width="49"><img src="../../images/el_2.gif" width="49" height="20"></td>
<td class="menubottom"><a href="../index.htm" class="menubottom">Теория</a> | <a href="../prakt.htm" class="menubottom">Практическая работа</a> | <a href="../samost.htm" class="menubottom">Самостоятельная работа</a> | <a href="javascript:alert('В данном курсе тестирование не предусмотрено')" class="menubottom">Тестирование</a></td>
</tr>
</table></td>
</tr>
</table></td>
<td width="2" valign="top" background="../../images/bg_rmain.gif" bgcolor="#FFFFFF" class="bgrxbtm"><img src="../../images/el_1.gif" width="2" height="17"></td>
<td width="27" background="../../images/bg_main.gif" class="bgrx"><img src="../../images/spacer.gif" width="27" height="1"></td>
</tr>
</table></td>
</tr>
<tr>
<td height="1" bgcolor="#5A8395"><table width="100%"  border="0" cellpadding="0" cellspacing="0" bgcolor="#5A8395">
<tr>
<td width="26" rowspan="2"><span class="bgrx"><img src="../../images/spacer.gif" width="26" height="8"></span></td>
<td width="37" height="31" background="../../images/bg_bottom.gif"><img src="../../images/spacer.gif" width="37" height="1"></td>
<td background="../../images/bg_bottom.gif" class="cpr">Copyright &copy; 2009 All right reserved</td>
<td width="26" background="../../images/bg_bottom.gif" class="cpr"><img src="../../images/el_bottom.gif" width="26" height="31"></td>
<td width="27" rowspan="2"><span class="bgrx"><img src="../../images/spacer.gif" width="27" height="8"></span></td>
</tr>
<tr>
<td height="11" colspan="3"><img src="../../images/spacer.gif" width="1" height="11"></td>
</tr>
</table></td>
</tr>
</table>
</body>
<!-- InstanceEnd --></html>
